var unread = {"max":1000,"unreadcounts":[{"id":"feed/http://rss1.smashingmagazine.com/feed/","count":7,"newestItemTimestampUsec":"1293117262334608"},{"id":"feed/http://msdn.microsoft.com/en-us/magazine/rss/default.aspx?z\u003dz\u0026iss\u003d1","count":5,"newestItemTimestampUsec":"1294181652152607"},{"id":"user/14163932302357347397/label/Fun","count":14,"newestItemTimestampUsec":"1294184127006513"},{"id":"feed/http://feeds.howtogeek.com/HowToGeek","count":86,"newestItemTimestampUsec":"1294174852415441"},{"id":"feed/http://feeds.feedburner.com/Techcrunch",
"count":65,"newestItemTimestampUsec":"1294186985072851"},{"id":"user/14163932302357347397/state/com.google/reading-list","count":872,"newestItemTimestampUsec":"1294186985072851"},{"id":"feed/http://www.webmonkey.com/rss/blog","count":4,"newestItemTimestampUsec":"1294160771182043"},{"id":"feed/http://feeds2.feedburner.com/collegehumor/articles","count":9,"newestItemTimestampUsec":"1294184127006513"},{"id":"user/14163932302357347397/label/Technology","count":131,"newestItemTimestampUsec":"1294186985072851"
},{"id":"feed/http://feeds.feedburner.com/SexIsFun","count":5,"newestItemTimestampUsec":"1294124471825508"},{"id":"feed/http://feeds.theonion.com/OnionNewsNetwork","count":5,"newestItemTimestampUsec":"1293561440480975"},{"id":"feed/http://rss.slashdot.org/Slashdot/slashdot","count":50,"newestItemTimestampUsec":"1294186102975449"},{"id":"feed/http://www.popsci.com/full-feed/science","count":53,"newestItemTimestampUsec":"1294168692199674"},{"id":"user/14163932302357347397/label/nook","count":681,"newestItemTimestampUsec":"1294186152330223"
},{"id":"feed/http://lifehacker.com/vip.xml","count":542,"newestItemTimestampUsec":"1294186152330223"},{"id":"feed/http://forums.g4tv.com/external.php?type\u003dRSS2","count":41,"newestItemTimestampUsec":"1294178529156390"}]}


var subs = 
{"subscriptions":[{"id":"feed/http://feeds.feedburner.com/24ways","title":"24 ways","categories":[],"sortid":"5BEAD506","firstitemmsec":"1229299462922","htmlUrl":"http://24ways.org/"},{"id":"feed/http://feeds.feedburner.com/AutocompleteMe","title":"Autocomplete Me","categories":[{"id":"user/14163932302357347397/label/Fun","label":"Fun"}],"sortid":"A6963156","firstitemmsec":"1258144630490","htmlUrl":"http://failblog.org"},{"id":"feed/http://britanick.com/rss.php","title":"BriTANick","categories":[
{"id":"user/14163932302357347397/label/comics","label":"comics"}],"sortid":"0C27490C","firstitemmsec":"1234072469158","htmlUrl":"http://www.britanick.com"},{"id":"feed/http://feeds2.feedburner.com/collegehumor/articles","title":"CollegeHumor","categories":[{"id":"user/14163932302357347397/label/Fun","label":"Fun"}],"sortid":"FC8831FC","firstitemmsec":"1242242374210","htmlUrl":"http://www.collegehumor.com"},{"id":"feed/http://xkcd.com/rss.xml","title":"Comic Fun","categories":[{"id":"user/14163932302357347397/label/Fun",
"label":"Fun"}],"sortid":"6795ABCE","firstitemmsec":"1233255392885","htmlUrl":"http://xkcd.com/"},{"id":"feed/http://www.css3.info/blog/feed/","title":"CSS3 . Info","categories":[{"id":"user/14163932302357347397/label/Technology","label":"Technology"}],"sortid":"3B9B03B2","firstitemmsec":"1245202602782","htmlUrl":"http://www.css3.info"},{"id":"feed/http://googledocs.blogspot.com/atom.xml","title":"Docs Blog","categories":[{"id":"user/14163932302357347397/label/Google Stuff","label":"Google Stuff"
}],"sortid":"24219686","firstitemmsec":"1243876145898","htmlUrl":"http://googledocs.blogspot.com/"},{"id":"feed/http://forums.g4tv.com/external.php?type\u003dRSS2","title":"G4tv.com Forums","categories":[],"sortid":"717F6860","firstitemmsec":"1281412894586","htmlUrl":"http://forums.g4tv.com"},{"id":"feed/http://feeds.feedburner.com/GearsApiBlog","title":"Gears API Blog","categories":[{"id":"user/14163932302357347397/label/Google Stuff","label":"Google Stuff"}],"sortid":"D90738E0","firstitemmsec":"1214858126076",
"htmlUrl":"http://gearsblog.blogspot.com/"},{"id":"feed/http://feeds.feedburner.com/OfficialGmailBlog","title":"Gmail Blog","categories":[{"id":"user/14163932302357347397/label/Google Stuff","label":"Google Stuff"}],"sortid":"CAD79FAC","firstitemmsec":"1244162810698","htmlUrl":"http://gmailblog.blogspot.com/"},{"id":"feed/http://feeds.feedburner.com/GoogleAppEngineBlog","title":"Google App Engine Blog","categories":[{"id":"user/14163932302357347397/label/Google Stuff","label":"Google Stuff"}],"sortid":"4695BE84",
"firstitemmsec":"1240449543489","htmlUrl":"http://googleappengine.blogspot.com/"},{"id":"feed/http://blog.outer-court.com/rss.xml","title":"Google Blogoscoped","categories":[{"id":"user/14163932302357347397/label/Google Stuff","label":"Google Stuff"}],"sortid":"496E339E","firstitemmsec":"1233255392885","htmlUrl":"http://blogoscoped.com"},{"id":"feed/http://feeds.feedburner.com/blogspot/Egta","title":"Google Chrome Blog","categories":[{"id":"user/14163932302357347397/label/Google Stuff","label":"Google Stuff"
}],"sortid":"CA24FC90","firstitemmsec":"1245728302324","htmlUrl":"http://chrome.blogspot.com/"},{"id":"feed/http://feeds.feedburner.com/GoogleChromeReleases","title":"Google Chrome Releases","categories":[{"id":"user/14163932302357347397/label/Google Stuff","label":"Google Stuff"}],"sortid":"E3E82A72","firstitemmsec":"1244152073673","htmlUrl":"http://googlechromereleases.blogspot.com/"},{"id":"feed/http://feeds.feedburner.com/blogspot/Dcni","title":"Google Code Blog","categories":[{"id":"user/14163932302357347397/label/Google Stuff",
"label":"Google Stuff"}],"sortid":"27B80193","firstitemmsec":"1245980488700","htmlUrl":"http://googlecode.blogspot.com/"},{"id":"feed/http://feeds.feedburner.com/GoogleOpenSourceBlog","title":"Google Open Source Blog","categories":[{"id":"user/14163932302357347397/label/Google Stuff","label":"Google Stuff"}],"sortid":"75EFF7C1","firstitemmsec":"1245807401670","htmlUrl":"http://google-opensource.blogspot.com/"},{"id":"feed/http://feeds.feedburner.com/GoogleVoiceBlog","title":"Google Voice Blog","categories":[
{"id":"user/14163932302357347397/label/Google Stuff","label":"Google Stuff"}],"sortid":"36EF047A","firstitemmsec":"1245728467876","htmlUrl":"http://googlevoiceblog.blogspot.com/"},{"id":"feed/http://feeds.feedburner.com/GoogleWaveDeveloperBlog","title":"Google Wave Developer Blog","categories":[{"id":"user/14163932302357347397/label/Google Stuff","label":"Google Stuff"}],"sortid":"AD5AC54B","firstitemmsec":"1245746345793","htmlUrl":"http://googlewavedev.blogspot.com/"},{"id":"feed/http://feeds.feedburner.com/istartedsomething",
"title":"istartedsomething","categories":[{"id":"user/14163932302357347397/label/Microsoft Stuff","label":"Microsoft Stuff"}],"sortid":"35CB8A87","firstitemmsec":"1249410721768","htmlUrl":"http://www.istartedsomething.com"},{"id":"feed/http://lifehacker.com/vip.xml","title":"Lifehacker","categories":[{"id":"user/14163932302357347397/label/nook","label":"nook"}],"sortid":"DEE9F5A8","firstitemmsec":"1268247153706","htmlUrl":"http://lifehacker.com"},{"id":"feed/http://msftkitchen.com/feed/","title":"Microsoft Kitchen",
"categories":[{"id":"user/14163932302357347397/label/Technology","label":"Technology"},{"id":"user/14163932302357347397/label/Microsoft Stuff","label":"Microsoft Stuff"}],"sortid":"F32ECB8F","firstitemmsec":"1254676556786","htmlUrl":"http://msftkitchen.com"},{"id":"feed/http://msdn.microsoft.com/en-us/magazine/rss/default.aspx?z\u003dz\u0026iss\u003d1","title":"MSDN Magazine: RSS Feed","categories":[{"id":"user/14163932302357347397/label/Technology","label":"Technology"}],"sortid":"E1054661","firstitemmsec":"1291464034017",
"htmlUrl":"http://msdn.microsoft.com/magazine"},{"id":"feed/http://www.qbyte.org/puzzles/rss2.xml","title":"Nick's Mathematical Puzzles","categories":[],"sortid":"61107A17","firstitemmsec":"1233255392887","htmlUrl":"http://www.qbyte.org/puzzles/"},{"id":"feed/http://feeds.feedburner.com/blogspot/dtKx","title":"Official Google Reader Blog","categories":[{"id":"user/14163932302357347397/label/Google Stuff","label":"Google Stuff"}],"sortid":"D2C8B42F","firstitemmsec":"1229630771820","htmlUrl":"http://googlereader.blogspot.com/"
},{"id":"feed/http://googlereader.blogspot.com/atom.xml","title":"Official Google Reader Blog","categories":[{"id":"user/14163932302357347397/label/Google Stuff","label":"Google Stuff"}],"sortid":"4716EC7B","firstitemmsec":"1233255392885","htmlUrl":"http://googlereader.blogspot.com/"},{"id":"feed/http://feeds.theonion.com/OnionNewsNetwork","title":"Onion Videos","categories":[{"id":"user/14163932302357347397/label/Fun","label":"Fun"}],"sortid":"74478B9F","firstitemmsec":"1247758322369","htmlUrl":"http://www.theonion.com/onn/"
},{"id":"feed/http://www.popsci.com/full-feed/science","title":"Popular Science","categories":[{"id":"user/14163932302357347397/label/nook","label":"nook"}],"sortid":"CC4FF34C","firstitemmsec":"1272384512658","htmlUrl":"http://www.popsci.com/full-feed/science"},{"id":"feed/http://www.psprumors.com/index.rdf","title":"PSPrumors.com","categories":[],"sortid":"DB8A3D04","firstitemmsec":"1233255392884","htmlUrl":"http://www.psprumors.com"},{"id":"feed/http://rss.slashdot.org/Slashdot/slashdot","title":"Slashdot",
"categories":[{"id":"user/14163932302357347397/label/Technology","label":"Technology"}],"sortid":"0B6755C4","firstitemmsec":"1233255392888","htmlUrl":"http://slashdot.org/"},{"id":"feed/http://rss1.smashingmagazine.com/feed/","title":"Smashing Magazine Feed","categories":[{"id":"user/14163932302357347397/label/Technology","label":"Technology"}],"sortid":"13666A71","firstitemmsec":"1266243323275","htmlUrl":"http://www.smashingmagazine.com/"},{"id":"feed/http://www.mangafox.com/rss/sundome.xml","title":"Sundome",
"categories":[],"sortid":"11A3D7CB","firstitemmsec":"1256130980698","htmlUrl":"http://www.mangafox.com/manga/sundome/"},{"id":"feed/http://feeds.feedburner.com/Techcrunch","title":"TechCrunch","categories":[{"id":"user/14163932302357347397/label/Technology","label":"Technology"}],"sortid":"6947B54A","firstitemmsec":"1233255392886","htmlUrl":"http://techcrunch.com"},{"id":"feed/http://feeds.feedburner.com/SexIsFun","title":"The Best Article Every day","categories":[],"sortid":"A0B29D44","firstitemmsec":"1233255392886",
"htmlUrl":"http://www.bspcn.com"},{"id":"feed/http://feeds.howtogeek.com/HowToGeek","title":"the How-To Geek","categories":[{"id":"user/14163932302357347397/label/nook","label":"nook"}],"sortid":"F51C39C3","firstitemmsec":"1262211949453","htmlUrl":"http://www.howtogeek.com"},{"id":"feed/http://feeds.feedburner.com/blogspot/MKuf","title":"The Official Google Blog","categories":[{"id":"user/14163932302357347397/label/Google Stuff","label":"Google Stuff"}],"sortid":"82029061","firstitemmsec":"1247238192762",
"htmlUrl":"http://googleblog.blogspot.com/"},{"id":"feed/http://blogs.msdn.com/b/oldnewthing/rss.aspx","title":"The Old New Thing","categories":[{"id":"user/14163932302357347397/label/Microsoft Stuff","label":"Microsoft Stuff"}],"sortid":"32884237","firstitemmsec":"1275575309168","htmlUrl":"http://blogs.msdn.com/b/oldnewthing/"},{"id":"feed/http://feeds.feedburner.com/TheSecretDiaryOfSteveJobs","title":"The Secret Diary of Steve Jobs » Steve","categories":[{"id":"user/14163932302357347397/label/Fun",
"label":"Fun"}],"sortid":"F0A8D0F1","firstitemmsec":"1268176247245","htmlUrl":"http://www.fakesteve.net"},{"id":"feed/http://notch.tumblr.com/rss","title":"The Word of Notch","categories":[],"sortid":"A07AC8B5","firstitemmsec":"1284852073649","htmlUrl":"http://notch.tumblr.com/"},{"id":"feed/http://twitter.com/statuses/user_timeline/115485051.rss","title":"Twitter / ConanOBrien","categories":[{"id":"user/14163932302357347397/label/Fun","label":"Fun"}],"sortid":"07A429DD","firstitemmsec":"1272920213596",
"htmlUrl":"http://twitter.com/ConanOBrien"},{"id":"feed/http://www.webdesignfromscratch.com/rss.xml","title":"Web Design from Scratch","categories":[],"sortid":"8CEC9552","firstitemmsec":"1233255392887","htmlUrl":"http://www.webdesignfromscratch.com"},{"id":"feed/http://www.webmonkey.com/rss/blog","title":"Webmonkey","categories":[{"id":"user/14163932302357347397/label/Technology","label":"Technology"}],"sortid":"280F69A2","firstitemmsec":"1259186434716","htmlUrl":"http://www.webmonkey.com"}]};

var options = {
	showZero : true
}

var subscriptions = {
	all : {},
	feeds : [],
	folders : [],
	allCount : 0,
	totalCountShown : 0,
	curPage : 0,
	
	/**
	 * Initialize the list of items that we have
	 * @param {Object} allOfThem the json that contains the subscriptions
	 */
	init : function(allOfThem){
		allOfThem = allOfThem.subscriptions;
				
		for (var i in allOfThem){			
			var it = allOfThem[i];			
			this.all[it.id] = it;	
			it.unreadCount = 0;
		}
		
		for (var i in this.all){
			var it = this.all[i];
			
			if (it.categories && it.categories.length > 0){
				for (var j = 0; j < it.categories.length; j++){
					
					var that = this.all[it.categories[j].id];
					if (that == null || that.isFromOptions){
						that = {"unreadCount" : 0, "title" : it.categories[j].label, id : it.categories[j].id}
						this.all[it.categories[j].id] = that;
						this.folders.push(that);
					}
					
					if (that.children == null)
						that.children = [];
					that.children.push(it);
				}						
			} else {
				this.feeds.push(it);

			}
			
		}
	},
	
	/**
	 * Update the unread count of labels/feeds
	 * @param {Object} unJson
	 */
	updateUnreadCount : function(unJson){
		unJson = unJson.unreadcounts;
		for (var i in unJson){
			if (unJson[i].id.substr(-23) == "com.google/reading-list")
				this.allCount = unJson[i].count;
			else if (this.all[unJson[i].id] != null){				
				this.all[unJson[i].id].unreadCount = unJson[i].count;
				
			}
		}
	
	},
	
	constructList : function(withCount){
		if (withCount == null)
			withCount = true;
		
		if (withCount) count = function (element){return ' (<span>' + element.unreadCount +"</span>)";}
		
		else count = function(){return ""};				
		
		var html = '<ul>';
		var theCount = 1;
		html += "<li id='subs-1'>All Items" + (withCount ? " (" + this.allCount + ")</li>" : "");
		for (var i = 0; i < this.folders.length; i++){

			var folder = this.folders[i];
			if (folder.unreadCount == 0 && !options.showZero)
				continue;
			theCount++;
			
			html += '<li id="subs-' + theCount + '" data-uri="' + folder.id + '">' + folder.title + count(folder) + "<ul>";
			for (var j = 0; j < folder.children.length; j++) {
				if (folder.children[j].unreadCount == 0 && !options.showZero)
					continue;
				theCount++;
				html += '<li id="subs-' + theCount + '" data-uri="' + folder.children[j].id + '">' + folder.children[j].title + count(folder.children[j]) + '</li>';
			}
			html += '</ul></li>';
		}		
		
		for (var i = 0; i < this.feeds.length; i++){
			if (this.feeds[i].unreadCount == 0 && !options.showZero)
				continue;
			theCount++;
			html += '<li id="subs-' + theCount + '" data-uri="' +  this.feeds[i].id + '">' + this.feeds[i].title + count(this.feeds[i]) + '</li>';
			
		}
		
		this.totalCountShown = theCount;
	
		document.getElementById('subs-list').innerHTML = html;
		this.updatePageNumber();
	},
	
	prevPage : function(){
		var element = document.getElementById('subs-list');
		var num = Number(element.style.top.substring(0,element.style.top.length - 2));
		if (num < 0){
			element.style.top = (num + 680) + "px";
			this.curPage--;
			this.updatePageNumber();
		}
		
		
	},
	
	nextPage : function(){
		var element = document.getElementById('subs-list');
		var num = Number(element.style.top.substring(0,element.style.top.length - 2));
		if (Math.round(this.totalCountShown / 20,0) > this.curPage ){
			element.style.top = (num - 680) + "px";
			this.curPage++;
			this.updatePageNumber();
		}
			
	},
	
	firstPage : function(){
		element.style.top = '0px';
		this.curPage = 0;
		this.updatePageNumber();
	},

	
	updatePageNumber : function(){
		document.getElementById('subs-page').innerHTML = this.curPage + 1 + "/" + (Math.round(this.totalCountShown / 20,0) + 1);
	},
	
		
	choose : function(num){
		num = this.curPage * 20 + num;
		if (num == 1)
			return 'user/-/state/com.google/reading-list'
		else{
			var element = document.getElementById('subs-' + num);
			if (element == null)
				return '';
			else return element.getAttribute('data-uri');
		}
		
	}

}

function onLoad(){
	subscriptions.init(subs);
	subscriptions.updateUnreadCount(unread);
	subscriptions.constructList(true);
	alert(subscriptions.choose(3));
}

window.onload = onLoad;


